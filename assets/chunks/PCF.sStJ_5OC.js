import{d as de,o as q,c as T,r as Ue,p as C,h as Me,v as Ze,q as ge,j as $,t as be,e as we,F as Be,B as Je,G as ae,ai as Xe,w as He,af as Ye,ag as Ve,W as Ke,a as et,_ as tt}from"./framework.DSOql0Gm.js";var V=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Q={},j={},M={},J={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.parseRotation=r.parseRotationName=r.Rotation=r.parsePiece=r.parsePieceName=r.isMinoPiece=r.Piece=void 0;var e;(function(i){i[i.Empty=0]="Empty",i[i.I=1]="I",i[i.L=2]="L",i[i.O=3]="O",i[i.Z=4]="Z",i[i.T=5]="T",i[i.J=6]="J",i[i.S=7]="S",i[i.Gray=8]="Gray"})(e=r.Piece||(r.Piece={}));function t(i){return i!==e.Empty&&i!==e.Gray}r.isMinoPiece=t;function n(i){switch(i){case e.I:return"I";case e.L:return"L";case e.O:return"O";case e.Z:return"Z";case e.T:return"T";case e.J:return"J";case e.S:return"S";case e.Gray:return"X";case e.Empty:return"_"}throw new Error("Unknown piece: ".concat(i))}r.parsePieceName=n;function o(i){switch(i.toUpperCase()){case"I":return e.I;case"L":return e.L;case"O":return e.O;case"Z":return e.Z;case"T":return e.T;case"J":return e.J;case"S":return e.S;case"X":case"GRAY":return e.Gray;case" ":case"_":case"EMPTY":return e.Empty}throw new Error("Unknown piece: ".concat(i))}r.parsePiece=o;var s;(function(i){i[i.Spawn=0]="Spawn",i[i.Right=1]="Right",i[i.Reverse=2]="Reverse",i[i.Left=3]="Left"})(s=r.Rotation||(r.Rotation={}));function l(i){switch(i){case s.Spawn:return"spawn";case s.Left:return"left";case s.Right:return"right";case s.Reverse:return"reverse"}throw new Error("Unknown rotation: ".concat(i))}r.parseRotationName=l;function a(i){switch(i.toLowerCase()){case"spawn":return s.Spawn;case"left":return s.Left;case"right":return s.Right;case"reverse":return s.Reverse}throw new Error("Unknown rotation: ".concat(i))}r.parseRotation=a})(J);Object.defineProperty(M,"__esModule",{value:!0});M.getPieces=M.getBlocks=M.getBlockXYs=M.getBlockPositions=M.PlayField=M.InnerField=M.createInnerField=M.createNewInnerField=void 0;var R=J,b={Width:10,Height:23,PlayBlocks:23*10};function rt(){return new Ee({})}M.createNewInnerField=rt;function nt(r){for(var e=new Ee({}),t=-1;t<b.Height;t+=1)for(var n=0;n<b.Width;n+=1){var o=r.at(n,t);e.setNumberAt(n,t,(0,R.parsePiece)(o))}return e}M.createInnerField=nt;var Ee=function(){function r(e){var t=e.field,n=t===void 0?r.create(b.PlayBlocks):t,o=e.garbage,s=o===void 0?r.create(b.Width):o;this.field=n,this.garbage=s}return r.create=function(e){return new Ce({length:e})},r.prototype.fill=function(e){this.field.fill(e)},r.prototype.fillAll=function(e,t){this.field.fillAll(e,t)},r.prototype.canFill=function(e,t,n,o){var s=this,l=qe(e,t,n,o);return l.every(function(a){var i=a[0],c=a[1];return 0<=i&&i<10&&0<=c&&c<b.Height&&s.getNumberAt(i,c)===R.Piece.Empty})},r.prototype.canFillAll=function(e){var t=this;return e.every(function(n){var o=n.x,s=n.y;return 0<=o&&o<10&&0<=s&&s<b.Height&&t.getNumberAt(o,s)===R.Piece.Empty})},r.prototype.isOnGround=function(e,t,n,o){return!this.canFill(e,t,n,o-1)},r.prototype.clearLine=function(){this.field.clearLine()},r.prototype.riseGarbage=function(){this.field.up(this.garbage),this.garbage.clearAll()},r.prototype.mirror=function(){this.field.mirror()},r.prototype.shiftToLeft=function(){this.field.shiftToLeft()},r.prototype.shiftToRight=function(){this.field.shiftToRight()},r.prototype.shiftToUp=function(){this.field.shiftToUp()},r.prototype.shiftToBottom=function(){this.field.shiftToBottom()},r.prototype.copy=function(){return new r({field:this.field.copy(),garbage:this.garbage.copy()})},r.prototype.equals=function(e){return this.field.equals(e.field)&&this.garbage.equals(e.garbage)},r.prototype.addNumber=function(e,t,n){0<=t?this.field.addOffset(e,t,n):this.garbage.addOffset(e,-(t+1),n)},r.prototype.setNumberFieldAt=function(e,t){this.field.setAt(e,t)},r.prototype.setNumberGarbageAt=function(e,t){this.garbage.setAt(e,t)},r.prototype.setNumberAt=function(e,t,n){return 0<=t?this.field.set(e,t,n):this.garbage.set(e,-(t+1),n)},r.prototype.getNumberAt=function(e,t){return 0<=t?this.field.get(e,t):this.garbage.get(e,-(t+1))},r.prototype.getNumberAtIndex=function(e,t){return t?this.getNumberAt(e%10,Math.floor(e/10)):this.getNumberAt(e%10,-(Math.floor(e/10)+1))},r.prototype.toFieldNumberArray=function(){return this.field.toArray()},r.prototype.toGarbageNumberArray=function(){return this.garbage.toArray()},r}();M.InnerField=Ee;var Ce=function(){function r(e){var t=e.pieces,n=e.length,o=n===void 0?b.PlayBlocks:n;t!==void 0?this.pieces=t:this.pieces=Array.from({length:o}).map(function(){return R.Piece.Empty}),this.length=o}return r.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.join("").trim();return r.loadInner(n)},r.loadMinify=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.join("").trim();return r.loadInner(n,n.length)},r.loadInner=function(e,t){var n=t!==void 0?t:e.length;if(n%10!==0)throw new Error("Num of blocks in field should be mod 10");for(var o=t!==void 0?new r({length:t}):new r({}),s=0;s<n;s+=1){var l=e[s];o.set(s%10,Math.floor((n-s-1)/10),(0,R.parsePiece)(l))}return o},r.prototype.get=function(e,t){return this.pieces[e+t*b.Width]},r.prototype.addOffset=function(e,t,n){this.pieces[e+t*b.Width]+=n},r.prototype.set=function(e,t,n){this.setAt(e+t*b.Width,n)},r.prototype.setAt=function(e,t){this.pieces[e]=t},r.prototype.fill=function(e){for(var t=e.type,n=e.rotation,o=e.x,s=e.y,l=pe(t,n),a=0,i=l;a<i.length;a++){var c=i[a],f=[o+c[0],s+c[1]],d=f[0],m=f[1];this.set(d,m,t)}},r.prototype.fillAll=function(e,t){for(var n=0,o=e;n<o.length;n++){var s=o[n],l=s.x,a=s.y;this.set(l,a,t)}},r.prototype.clearLine=function(){for(var e=this.pieces.concat(),t=this.pieces.length/b.Width-1,n=t;0<=n;n-=1){var o=this.pieces.slice(n*b.Width,(n+1)*b.Width),s=o.every(function(i){return i!==R.Piece.Empty});if(s){var l=e.slice(0,n*b.Width),a=e.slice((n+1)*b.Width);e=l.concat(a,Array.from({length:b.Width}).map(function(){return R.Piece.Empty}))}}this.pieces=e},r.prototype.up=function(e){this.pieces=e.pieces.concat(this.pieces).slice(0,this.length)},r.prototype.mirror=function(){for(var e=[],t=0;t<this.pieces.length;t+=1){var n=this.pieces.slice(t*b.Width,(t+1)*b.Width);n.reverse();for(var o=0,s=n;o<s.length;o++){var l=s[o];e.push(l)}}this.pieces=e},r.prototype.shiftToLeft=function(){for(var e=this.pieces.length/10,t=0;t<e;t+=1){for(var n=0;n<b.Width-1;n+=1)this.pieces[n+t*b.Width]=this.pieces[n+1+t*b.Width];this.pieces[9+t*b.Width]=R.Piece.Empty}},r.prototype.shiftToRight=function(){for(var e=this.pieces.length/10,t=0;t<e;t+=1){for(var n=b.Width-1;1<=n;n-=1)this.pieces[n+t*b.Width]=this.pieces[n-1+t*b.Width];this.pieces[t*b.Width]=R.Piece.Empty}},r.prototype.shiftToUp=function(){var e=Array.from({length:10}).map(function(){return R.Piece.Empty});this.pieces=e.concat(this.pieces).slice(0,this.length)},r.prototype.shiftToBottom=function(){var e=Array.from({length:10}).map(function(){return R.Piece.Empty});this.pieces=this.pieces.slice(10,this.length).concat(e)},r.prototype.toArray=function(){return this.pieces.concat()},Object.defineProperty(r.prototype,"numOfBlocks",{get:function(){return this.pieces.length},enumerable:!1,configurable:!0}),r.prototype.copy=function(){return new r({pieces:this.pieces.concat(),length:this.length})},r.prototype.toShallowArray=function(){return this.pieces},r.prototype.clearAll=function(){this.pieces=this.pieces.map(function(){return R.Piece.Empty})},r.prototype.equals=function(e){if(this.pieces.length!==e.pieces.length)return!1;for(var t=0;t<this.pieces.length;t+=1)if(this.pieces[t]!==e.pieces[t])return!1;return!0},r}();M.PlayField=Ce;function qe(r,e,t,n){return pe(r,e).map(function(o){return o[0]+=t,o[1]+=n,o})}M.getBlockPositions=qe;function it(r,e,t,n){return pe(r,e).map(function(o){return{x:o[0]+t,y:o[1]+n}})}M.getBlockXYs=it;function pe(r,e){var t=Te(r);switch(e){case R.Rotation.Spawn:return t;case R.Rotation.Left:return at(t);case R.Rotation.Reverse:return ct(t);case R.Rotation.Right:return ot(t)}throw new Error("Unsupported block")}M.getBlocks=pe;function Te(r){switch(r){case R.Piece.I:return[[0,0],[-1,0],[1,0],[2,0]];case R.Piece.T:return[[0,0],[-1,0],[1,0],[0,1]];case R.Piece.O:return[[0,0],[1,0],[0,1],[1,1]];case R.Piece.L:return[[0,0],[-1,0],[1,0],[1,1]];case R.Piece.J:return[[0,0],[-1,0],[1,0],[-1,1]];case R.Piece.S:return[[0,0],[-1,0],[0,1],[1,1]];case R.Piece.Z:return[[0,0],[1,0],[0,1],[-1,1]]}throw new Error("Unsupported rotation")}M.getPieces=Te;function ot(r){return r.map(function(e){return[e[1],-e[0]]})}function at(r){return r.map(function(e){return[-e[1],e[0]]})}function ct(r){return r.map(function(e){return[-e[0],-e[1]]})}var ne={};Object.defineProperty(ne,"__esModule",{value:!0});ne.Buffer=void 0;var Ae="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",st=function(){function r(e){e===void 0&&(e=""),this.values=e.split("").map(ut)}return r.prototype.poll=function(e){for(var t=0,n=0;n<e;n+=1){var o=this.values.shift();if(o===void 0)throw new Error("Unexpected fumen");t+=o*Math.pow(r.tableLength,n)}return t},r.prototype.push=function(e,t){t===void 0&&(t=1);for(var n=e,o=0;o<t;o+=1)this.values.push(n%r.tableLength),n=Math.floor(n/r.tableLength)},r.prototype.merge=function(e){for(var t=0,n=e.values;t<n.length;t++){var o=n[t];this.values.push(o)}},r.prototype.isEmpty=function(){return this.values.length===0},Object.defineProperty(r.prototype,"length",{get:function(){return this.values.length},enumerable:!1,configurable:!0}),r.prototype.get=function(e){return this.values[e]},r.prototype.set=function(e,t){this.values[e]=t},r.prototype.toString=function(){return this.values.map(ft).join("")},r.tableLength=Ae.length,r}();ne.Buffer=st;function ut(r){return Ae.indexOf(r)}function ft(r){return Ae[r]}var U={},ue=V&&V.__assign||function(){return ue=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},ue.apply(this,arguments)};Object.defineProperty(U,"__esModule",{value:!0});U.createActionEncoder=U.createActionDecoder=void 0;var u=J;function K(r){return r!==0}var lt=function(r,e,t){var n=e+t,o=n*r;function s(i){switch(i){case 0:return u.Piece.Empty;case 1:return u.Piece.I;case 2:return u.Piece.L;case 3:return u.Piece.O;case 4:return u.Piece.Z;case 5:return u.Piece.T;case 6:return u.Piece.J;case 7:return u.Piece.S;case 8:return u.Piece.Gray}throw new Error("Unexpected piece")}function l(i){switch(i){case 0:return u.Rotation.Reverse;case 1:return u.Rotation.Right;case 2:return u.Rotation.Spawn;case 3:return u.Rotation.Left}throw new Error("Unexpected rotation")}function a(i,c,f){var d=i%r,m=Math.floor(i/10),w=e-m-1;return c===u.Piece.O&&f===u.Rotation.Left?(d+=1,w-=1):c===u.Piece.O&&f===u.Rotation.Reverse?d+=1:c===u.Piece.O&&f===u.Rotation.Spawn?w-=1:c===u.Piece.I&&f===u.Rotation.Reverse?d+=1:c===u.Piece.I&&f===u.Rotation.Left||c===u.Piece.S&&f===u.Rotation.Spawn?w-=1:c===u.Piece.S&&f===u.Rotation.Right?d-=1:c===u.Piece.Z&&f===u.Rotation.Spawn?w-=1:c===u.Piece.Z&&f===u.Rotation.Left&&(d+=1),{x:d,y:w}}return{decode:function(i){var c=i,f=s(c%8);c=Math.floor(c/8);var d=l(c%4);c=Math.floor(c/4);var m=a(c%o,f,d);c=Math.floor(c/o);var w=K(c%2);c=Math.floor(c/2);var p=K(c%2);c=Math.floor(c/2);var z=K(c%2);c=Math.floor(c/2);var g=K(c%2);c=Math.floor(c/2);var k=!K(c%2);return{rise:w,mirror:p,colorize:z,comment:g,lock:k,piece:ue(ue({},m),{type:f,rotation:d})}}}};U.createActionDecoder=lt;function ee(r){return r?1:0}var dt=function(r,e,t){var n=e+t,o=n*r;function s(a){var i=a.type,c=a.rotation,f=a.x,d=a.y;return(0,u.isMinoPiece)(i)?i===u.Piece.O&&c===u.Rotation.Left?(f-=1,d+=1):i===u.Piece.O&&c===u.Rotation.Reverse?f-=1:i===u.Piece.O&&c===u.Rotation.Spawn?d+=1:i===u.Piece.I&&c===u.Rotation.Reverse?f-=1:i===u.Piece.I&&c===u.Rotation.Left||i===u.Piece.S&&c===u.Rotation.Spawn?d+=1:i===u.Piece.S&&c===u.Rotation.Right?f+=1:i===u.Piece.Z&&c===u.Rotation.Spawn?d+=1:i===u.Piece.Z&&c===u.Rotation.Left&&(f-=1):(f=0,d=22),(e-d-1)*r+f}function l(a){var i=a.type,c=a.rotation;if(!(0,u.isMinoPiece)(i))return 0;switch(c){case u.Rotation.Reverse:return 0;case u.Rotation.Right:return 1;case u.Rotation.Spawn:return 2;case u.Rotation.Left:return 3}throw new Error("No reachable")}return{encode:function(a){var i=a.lock,c=a.comment,f=a.colorize,d=a.mirror,m=a.rise,w=a.piece,p=ee(!i);return p*=2,p+=ee(c),p*=2,p+=ee(f),p*=2,p+=ee(d),p*=2,p+=ee(m),p*=o,p+=s(w),p*=4,p+=l(w),p*=8,p+=w.type,p}}};U.createActionEncoder=dt;var ie={};Object.defineProperty(ie,"__esModule",{value:!0});ie.createCommentParser=void 0;var Pe=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",me=Pe.length+1,pt=function(){return{decode:function(r){for(var e="",t=r,n=0;n<4;n+=1){var o=t%me;e+=Pe[o],t=Math.floor(t/me)}return e},encode:function(r,e){return Pe.indexOf(r)*Math.pow(me,e)}}};ie.createCommentParser=pt;var oe={};Object.defineProperty(oe,"__esModule",{value:!0});oe.Quiz=void 0;var D=J,B;(function(r){r.Direct="direct",r.Swap="swap",r.Stock="stock"})(B||(B={}));var ht=function(){function r(e){this.quiz=r.verify(e)}return Object.defineProperty(r.prototype,"next",{get:function(){var e=this.quiz.indexOf(")")+1,t=this.quiz[e];return t===void 0||t===";"?"":t},enumerable:!1,configurable:!0}),r.isQuizComment=function(e){return e.startsWith("#Q=")},r.create=function(e,t){var n=function(o,s){var l=function(a){return a||""};return new r("#Q=[".concat(l(o),"](").concat(l(s[0]),")").concat(l(s.substring(1))))};return t!==void 0?n(e,t):n(void 0,e)},r.trim=function(e){return e.trim().replace(/\s+/g,"")},Object.defineProperty(r.prototype,"least",{get:function(){var e=this.quiz.indexOf(")");return this.quiz.substr(e+1)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"current",{get:function(){var e=this.quiz.indexOf("(")+1,t=this.quiz[e];return t===")"?"":t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"hold",{get:function(){var e=this.quiz.indexOf("[")+1,t=this.quiz[e];return t==="]"?"":t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"leastAfterNext2",{get:function(){var e=this.quiz.indexOf(")");return this.quiz[e+1]===";"?this.quiz.substr(e+1):this.quiz.substr(e+2)},enumerable:!1,configurable:!0}),r.prototype.getOperation=function(e){var t=(0,D.parsePieceName)(e),n=this.current;if(t===n)return B.Direct;var o=this.hold;if(t===o)return B.Swap;if(o===""){if(t===this.next)return B.Stock}else if(n===""&&t===this.next)return B.Direct;throw new Error("Unexpected hold piece in quiz: ".concat(this.quiz))},Object.defineProperty(r.prototype,"leastInActiveBag",{get:function(){var e=this.quiz.indexOf(";"),t=0<=e?this.quiz.substring(0,e):this.quiz,n=t.indexOf(")");return t[n+1]===";"?t.substr(n+1):t.substr(n+2)},enumerable:!1,configurable:!0}),r.verify=function(e){var t=this.trim(e);if(t.length===0||e==="#Q=[]()"||!e.startsWith("#Q="))return e;if(!t.match(/^#Q=\[[TIOSZJL]?]\([TIOSZJL]?\)[TIOSZJL]*;?.*$/i))throw new Error("Current piece doesn't exist, however next pieces exist: ".concat(e));return t},r.prototype.direct=function(){if(this.current===""){var e=this.leastAfterNext2;return new r("#Q=[".concat(this.hold,"](").concat(e[0],")").concat(e.substr(1)))}return new r("#Q=[".concat(this.hold,"](").concat(this.next,")").concat(this.leastAfterNext2))},r.prototype.swap=function(){if(this.hold==="")throw new Error("Cannot find hold piece: ".concat(this.quiz));var e=this.next;return new r("#Q=[".concat(this.current,"](").concat(e,")").concat(this.leastAfterNext2))},r.prototype.stock=function(){if(this.hold!==""||this.next==="")throw new Error("Cannot stock: ".concat(this.quiz));var e=this.leastAfterNext2,t=e[0]!==void 0?e[0]:"";return 1<e.length?new r("#Q=[".concat(this.current,"](").concat(t,")").concat(e.substr(1))):new r("#Q=[".concat(this.current,"](").concat(t,")"))},r.prototype.operate=function(e){switch(e){case B.Direct:return this.direct();case B.Swap:return this.swap();case B.Stock:return this.stock()}throw new Error("Unexpected operation")},r.prototype.format=function(){var e=this.nextIfEnd();if(e.quiz==="#Q=[]()")return new r("");var t=e.current,n=e.hold;if(t===""&&n!=="")return new r("#Q=[](".concat(n,")").concat(e.least));if(t===""){var o=e.least,s=o[0];return s===void 0?new r(""):s===";"?new r(o.substr(1)):new r("#Q=[](".concat(s,")").concat(o.substr(1)))}return e},r.prototype.getHoldPiece=function(){if(!this.canOperate())return D.Piece.Empty;var e=this.hold;return e===void 0||e===""||e===";"?D.Piece.Empty:(0,D.parsePiece)(e)},r.prototype.getNextPieces=function(e){if(!this.canOperate())return e!==void 0?Array.from({length:e}).map(function(){return D.Piece.Empty}):[];var t=(this.current+this.next+this.leastInActiveBag).substr(0,e);return e!==void 0&&t.length<e&&(t+=" ".repeat(e-t.length)),t.split("").map(function(n){return n===void 0||n===" "||n===";"?D.Piece.Empty:(0,D.parsePiece)(n)})},r.prototype.toString=function(){return this.quiz},r.prototype.canOperate=function(){var e=this.quiz;return e.startsWith("#Q=[]();")&&(e=this.quiz.substr(8)),e.startsWith("#Q=")&&e!=="#Q=[]()"},r.prototype.nextIfEnd=function(){return this.quiz.startsWith("#Q=[]();")?new r(this.quiz.substr(8)):this},r}();oe.Quiz=ht;var Z={},fe=V&&V.__assign||function(){return fe=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},fe.apply(this,arguments)};Object.defineProperty(Z,"__esModule",{value:!0});Z.Mino=Z.Field=void 0;var ce=M,G=J;function ye(r){return r instanceof ze?r.copy():ze.from(r)}var vt=function(){function r(e){this.field=e}return r.create=function(e,t){return new r(new ce.InnerField({field:e!==void 0?ce.PlayField.load(e):void 0,garbage:t!==void 0?ce.PlayField.loadMinify(t):void 0}))},r.prototype.canFill=function(e){if(e===void 0)return!0;var t=ye(e);return this.field.canFillAll(t.positions())},r.prototype.canLock=function(e){return e===void 0?!0:this.canFill(e)?!this.canFill(fe(fe({},e),{y:e.y-1})):!1},r.prototype.fill=function(e,t){if(t===void 0&&(t=!1),e!==void 0){var n=ye(e);if(!t&&!this.canFill(n))throw Error("Cannot fill piece on field");return this.field.fillAll(n.positions(),(0,G.parsePiece)(n.type)),n}},r.prototype.put=function(e){if(e!==void 0){for(var t=ye(e);0<=t.y;t.y-=1)if(this.canLock(t))return this.fill(t),t;throw Error("Cannot put piece on field")}},r.prototype.clearLine=function(){this.field.clearLine()},r.prototype.at=function(e,t){return(0,G.parsePieceName)(this.field.getNumberAt(e,t))},r.prototype.set=function(e,t,n){this.field.setNumberAt(e,t,(0,G.parsePiece)(n))},r.prototype.copy=function(){return new r(this.field.copy())},r.prototype.str=function(e){e===void 0&&(e={});for(var t=e.reduced!==void 0?e.reduced:!0,n=e.separator!==void 0?e.separator:`
`,o=e.garbage===void 0||e.garbage?-1:0,s="",l=22;o<=l;l-=1){for(var a="",i=0;i<10;i+=1)a+=this.at(i,l);t&&a==="__________"||(t=!1,s+=a,l!==o&&(s+=n))}return s},r}();Z.Field=vt;var ze=function(){function r(e,t,n,o){this.type=e,this.rotation=t,this.x=n,this.y=o}return r.from=function(e){return new r(e.type,e.rotation,e.x,e.y)},r.prototype.positions=function(){return(0,ce.getBlockXYs)((0,G.parsePiece)(this.type),(0,G.parseRotation)(this.rotation),this.x,this.y).sort(function(e,t){return e.y===t.y?e.x-t.x:e.y-t.y})},r.prototype.operation=function(){return{type:this.type,rotation:this.rotation,x:this.x,y:this.y}},r.prototype.isValid=function(){try{(0,G.parsePiece)(this.type),(0,G.parseRotation)(this.rotation)}catch{return!1}return this.positions().every(function(e){var t=e.x,n=e.y;return 0<=t&&t<10&&0<=n&&n<23})},r.prototype.copy=function(){return new r(this.type,this.rotation,this.x,this.y)},r}();Z.Mino=ze;Object.defineProperty(j,"__esModule",{value:!0});j.decode=j.extract=j.Page=void 0;var xe=M,gt=ne,te=J,mt=U,yt=ie,Ie=oe,Oe=Z,We=function(){function r(e,t,n,o,s,l){this.index=e,this.operation=n,this.comment=o,this.flags=s,this.refs=l,this._field=t.copy()}return Object.defineProperty(r.prototype,"field",{get:function(){return new Oe.Field(this._field.copy())},set:function(e){this._field=(0,xe.createInnerField)(e)},enumerable:!1,configurable:!0}),r.prototype.mino=function(){return Oe.Mino.from(this.operation)},r}();j.Page=We;var H={GarbageLine:1,Width:10};function je(r){var e=function(l,a){var i=a.trim().replace(/[?\s]+/g,"");return{version:l,data:i}},t=r,n=t.indexOf("&");0<=n&&(t=t.substring(0,n));{var o=r.match(/[vmd]115@/);if(o!=null&&o.index!==void 0){var s=t.substr(o.index+5);return e("115",s)}}{var o=r.match(/[vmd]110@/);if(o!=null&&o.index!==void 0){var s=t.substr(o.index+5);return e("110",s)}}throw new Error("Unsupported fumen version")}j.extract=je;function _t(r){var e=je(r),t=e.version,n=e.data;switch(t){case"115":return Se(n,23);case"110":return Se(n,21)}throw new Error("Unsupported fumen version")}j.decode=_t;function Se(r,e){for(var t=e+H.GarbageLine,n=t*H.Width,o=new gt.Buffer(r),s=function(I){for(var N={changed:!0,field:I},W=0;W<n;){var ve=o.poll(2),ke=Math.floor(ve/n),Le=ve%n;ke===8&&Le===n-1&&(N.changed=!1);for(var Fe=0;Fe<Le+1;Fe+=1){var $e=W%H.Width,Ge=e-Math.floor(W/H.Width)-1;N.field.addNumber($e,Ge,ke-8),W+=1}}return N},l=0,a=(0,xe.createNewInnerField)(),i={repeatCount:-1,refIndex:{comment:0,field:0},quiz:void 0,lastCommentText:""},c=[],f=(0,mt.createActionDecoder)(H.Width,e,H.GarbageLine),d=(0,yt.createCommentParser)();!o.isEmpty();){var m=void 0;0<i.repeatCount?(m={field:a,changed:!1},i.repeatCount-=1):(m=s(a.copy()),m.changed||(i.repeatCount=o.poll(1)));var w=o.poll(3),p=f.decode(w),z=void 0;if(p.comment){for(var g=[],k=o.poll(2),L=0;L<Math.floor((k+3)/4);L+=1){var E=o.poll(5);g.push(E)}for(var S="",A=0,x=g;A<x.length;A++){var X=x[A];S+=d.decode(X)}var h=unescape(S.slice(0,k));i.lastCommentText=h,z={text:h},i.refIndex.comment=l;var v=z.text;if(Ie.Quiz.isQuizComment(v))try{i.quiz=new Ie.Quiz(v)}catch{i.quiz=void 0}else i.quiz=void 0}else l===0?z={text:""}:z={text:i.quiz!==void 0?i.quiz.format().toString():void 0,ref:i.refIndex.comment};var y=!1;if(i.quiz!==void 0&&(y=!0,i.quiz.canOperate()&&p.lock))if((0,te.isMinoPiece)(p.piece.type))try{var _=i.quiz.nextIfEnd(),P=_.getOperation(p.piece.type);i.quiz=_.operate(P)}catch{i.quiz=i.quiz.format()}else i.quiz=i.quiz.format();var O=void 0;p.piece.type!==te.Piece.Empty&&(O=p.piece);var F=void 0;m.changed||l===0?(F={},i.refIndex.field=l):F={ref:i.refIndex.field},c.push(new We(l,m.field,O!==void 0?Oe.Mino.from({type:(0,te.parsePieceName)(O.type),rotation:(0,te.parseRotationName)(O.rotation),x:O.x,y:O.y}):void 0,z.text!==void 0?z.text:i.lastCommentText,{quiz:y,lock:p.lock,mirror:p.mirror,colorize:p.colorize,rise:p.rise},{field:F.ref,comment:z.ref})),l+=1,p.lock&&((0,te.isMinoPiece)(p.piece.type)&&m.field.fill(p.piece),m.field.clearLine(),p.rise&&m.field.riseGarbage(),p.mirror&&m.field.mirror()),a=m.field}return c}var he={},Re=V&&V.__assign||function(){return Re=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Re.apply(this,arguments)};Object.defineProperty(he,"__esModule",{value:!0});he.encode=void 0;var Ne=M,se=ne,Y=J,bt=U,wt=ie,Pt=oe,le={GarbageLine:1,Width:10};function zt(r){for(var e=function(z,g){var k=Ot(z,g),L=k.changed,E=k.values;if(L)n.merge(E),t=-1;else if(t<0||n.get(t)===se.Buffer.tableLength-1)n.merge(E),n.push(0),t=n.length-1;else if(n.get(t)<se.Buffer.tableLength-1){var S=n.get(t);n.set(t,S+1)}},t=-1,n=new se.Buffer,o=(0,Ne.createNewInnerField)(),s=(0,bt.createActionEncoder)(le.Width,23,le.GarbageLine),l=(0,wt.createCommentParser)(),a="",i=void 0,c=function(z){var g=r[z];g.flags=g.flags?g.flags:{};var k=g.field,L=k!==void 0?(0,Ne.createInnerField)(k):o.copy();e(o,L);var E=g.comment!==void 0&&(z!==0||g.comment!=="")?g.comment:void 0,S=g.operation!==void 0?{type:(0,Y.parsePiece)(g.operation.type),rotation:(0,Y.parseRotation)(g.operation.rotation),x:g.operation.x,y:g.operation.y}:{type:Y.Piece.Empty,rotation:Y.Rotation.Reverse,x:0,y:22},A;if(E!==void 0?E.startsWith("#Q=")?i!==void 0&&i.format().toString()===E?A=void 0:(A=E,a=A,i=new Pt.Quiz(E)):i!==void 0&&i.format().toString()===E?(A=void 0,a=E,i=void 0):(A=a!==E?E:void 0,a=a!==E?A:a,i=void 0):(A=void 0,i=void 0),i!==void 0&&i.canOperate()&&g.flags.lock)if((0,Y.isMinoPiece)(S.type))try{var x=i.nextIfEnd(),X=x.getOperation(S.type);i=x.operate(X)}catch{i=i.format()}else i=i.format();var h=Re({lock:!0,colorize:z===0},g.flags),v={piece:S,rise:!!h.rise,mirror:!!h.mirror,colorize:!!h.colorize,lock:!!h.lock,comment:A!==void 0},y=s.encode(v);if(n.push(y,3),A!==void 0){var _=escape(g.comment),P=Math.min(_.length,4095);n.push(P,2);for(var O=0;O<P;O+=4){for(var F=0,I=0;I<4;I+=1){var N=O+I;if(P<=N)break;var W=_.charAt(N);F+=l.encode(W,I)}n.push(F,5)}}else g.comment===void 0&&(a=void 0);v.lock&&((0,Y.isMinoPiece)(v.piece.type)&&L.fill(v.piece),L.clearLine(),v.rise&&L.riseGarbage(),v.mirror&&L.mirror()),o=L},f=0;f<r.length;f+=1)c(f);var d=n.toString();if(d.length<41)return d;var m=[d.substr(0,42)],w=d.substring(42),p=w.match(/[\S]{1,47}/g)||[];return m.concat(p).join("?")}he.encode=zt;function Ot(r,e){for(var t=23,n=t+1,o=n*le.Width,s=new se.Buffer,l=function(p,z){var g=t-z-1;return e.getNumberAt(p,g)-r.getNumberAt(p,g)+8},a=function(p,z){var g=p*o+z;s.push(g,2)},i=!0,c=l(0,0),f=-1,d=0;d<n;d+=1)for(var m=0;m<le.Width;m+=1){var w=l(m,d);w!==c?(a(c,f),f=0,c=w):f+=1}return a(c,f),c===8&&f===o-1&&(i=!1),{changed:i,values:s}}(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.encoder=r.decoder=r.Mino=r.Field=void 0;var e=j,t=he,n=Z;Object.defineProperty(r,"Field",{enumerable:!0,get:function(){return n.Field}}),Object.defineProperty(r,"Mino",{enumerable:!0,get:function(){return n.Mino}}),r.decoder={decode:function(o){return(0,e.decode)(o)}},r.encoder={encode:function(o){return"v115@".concat((0,t.encode)(o))}}})(Q);const Rt=de({__name:"TButton",emits:["click"],setup(r,{emit:e}){const t=e;return(n,o)=>(q(),T("button",{class:"vt-btn",onClick:o[0]||(o[0]=s=>t("click"))},[Ue(n.$slots,"default")]))}}),Mt={class:"field-div"},Et={class:"button-container"},Qe=de({__name:"VTetrisField",props:{page:{type:Object,default:null},height:{type:Number,default:20},cell_size:{type:Number,default:20},mirror:{type:Boolean,default:!1},allow_edit:{type:Boolean,default:!1},display_copy:{type:Boolean,default:!0}},emits:["field_change"],setup(r,{emit:e}){const t={T:["#b451ac","#e56add"],I:["#41afde","#43d3ff"],O:["#f7d33e","#fff952"],L:["#ef9535","#ffbf60"],J:["#1983bf","#1ba6f9"],S:["#66c65c","#88ee86"],Z:["#ef624d","#ff9484"],X:["#686868","#949494"],_:["#686868","#949494"]},n={T:["#b451ac","#e56add"],I:["#41afde","#43d3ff"],O:["#f7d33e","#fff952"],J:["#ef9535","#ffbf60"],L:["#1983bf","#1ba6f9"],Z:["#66c65c","#88ee86"],S:["#ef624d","#ff9484"],X:["#686868","#949494"],_:["#686868","#949494"]},o=C("Copy");function s(){return a.mirror?n:t}async function l(){const h=a.page,v=Q.encoder.encode([{field:h.field,comment:h.comment}]);navigator.clipboard.writeText(v),o.value="Done",setTimeout(()=>{o.value="Copy"},1e3)}const a=r,i=e;let c=C(a.page);var f=null;const d=C();function m(h,v){const y=v.field,_=a.height-1;for(var P=0;P<20;P++)for(var O=0;O<10;O++){let W=a.mirror?9-O:O;var F=y.at(W,P);F!="_"&&(h.fillStyle=s()[F][0],h.fillRect(O*a.cell_size,(_-P)*a.cell_size,a.cell_size,a.cell_size),h.fillStyle=s()[F][1],h.fillRect(O*a.cell_size,(_-P)*a.cell_size,a.cell_size,-a.cell_size/5))}if(!v.operation)return;const I=v.mino(),N=I.positions();h.lineWidth=2,h.lineJoin="round",h.strokeStyle=s()[I.type][0];for(var P=0;P<4;P++)h.strokeRect(N[P].x*a.cell_size+a.cell_size/10,(_-N[P].y)*a.cell_size+a.cell_size/10,a.cell_size*.8,a.cell_size*.8)}const w=Me(()=>{let h=BigInt(0);const v=c.value.field;for(var y=0;y<a.height;y++)for(var _=0;_<10;_++){let O=a.mirror?9-_:_;var P=v.at(O,y);const F=BigInt(y*10+_);P!="_"&&(h+=BigInt(1)<<F)}return h});function p(){const h=Object.assign(Object.create(Object.getPrototypeOf(c.value)),c.value);let v=h.field.copy();for(let y=0;y<a.height;y++)for(let _=0;_<10;_++)v.set(_,y,"_");h.field=v,c.value=h,a.allow_edit&&i("field_change",w.value)}const z=C(!1),g=C({x:-1,y:-1}),k=C("");function L(h){if(!a.allow_edit)return;z.value=!0;const{realX:v,realY:y}=x(h),_=a.mirror?9-v:v,P=c.value.field.at(_,y);k.value=P==="_"?"X":"_",X(v,y,k.value),g.value={x:v,y}}function E(h){if(!a.allow_edit||!z.value)return;const{realX:v,realY:y}=x(h);(v!==g.value.x||y!==g.value.y)&&(X(v,y,k.value),g.value={x:v,y})}function S(){z.value=!1}function A(){z.value=!1}function x(h){if(!d.value)return{realX:-1,realY:-1};const v=d.value.getBoundingClientRect(),y=d.value.width/v.width,_=d.value.height/v.height,P=Math.floor((h.clientX-v.left)*y/a.cell_size),O=a.height-1-Math.floor((h.clientY-v.top)*_/a.cell_size);return{realX:P,realY:O}}function X(h,v,y){const _=Object.assign(Object.create(Object.getPrototypeOf(c.value)),c.value);let P=_.field.copy();const O=a.mirror?9-h:h;P.set(O,v,y),_.field=P,c.value=_,a.allow_edit&&i("field_change",w.value)}return Ze(()=>{d.value&&(d.value.width=10*a.cell_size,d.value.height=a.height*a.cell_size,f=d.value.getContext("2d"),f&&(m(f,c.value),a.allow_edit&&i("field_change",w.value)))}),ge(()=>a.page,h=>{c.value=h,a.allow_edit&&i("field_change",w.value)}),ge(c,()=>{f&&(f.canvas.height=a.height*a.cell_size,f.clearRect(0,0,f.canvas.width,f.canvas.height),m(f,c.value))}),ge(()=>a.mirror,()=>{f&&(f.clearRect(0,0,f.canvas.width,f.canvas.height),m(f,c.value),a.allow_edit&&i("field_change",w.value))}),(h,v)=>(q(),T("div",Mt,[$("canvas",{class:"vt-field",ref_key:"canvas",ref:d,onMousedown:L,onMousemove:E,onMouseup:S,onMouseleave:A},null,544),$("div",Et,[r.display_copy?(q(),T("button",{key:0,type:"button",class:"action-btn copy-btn",onClick:l,title:"copy as fumen"},be(o.value),1)):we("",!0),r.allow_edit?(q(),T("button",{key:1,type:"button",class:"action-btn clear-btn",onClick:p,title:"clear field"},"Clear")):we("",!0)])]))}});function De(r){const e=t=>{switch(t){case"Z":return"S";case"S":return"Z";case"L":return"J";case"J":return"L";default:return t}};return[...r].map(t=>e(t)).join("")}function Tt(r){const t=r.map(n=>Q.decoder.decode(n)).flat().map(n=>({field:n.field}));return Q.encoder.encode(t)}function xt(r){const t=Q.decoder.decode(r).map(n=>({field:n.field,comment:De(n.comment)}));return Q.encoder.encode(t)}const At={class:"fumen-list"},kt={class:"fumen-item"},Lt=de({__name:"TFumenList",props:{fumen:{type:String,default:"v115@vhAAgH"},height:{type:Number,default:20},cell_size:{type:Number,default:20},mirror:{type:Boolean,default:!1},display_copy:{type:Boolean,default:!0}},setup(r){const e=r,t=Me(()=>{const n=Q.decoder.decode(e.fumen);return e.mirror?n.map(o=>{const s=Object.assign(Object.create(Object.getPrototypeOf(o)),o);return s.comment=De(o.comment),s}):n});return(n,o)=>(q(),T("div",At,[(q(!0),T(Be,null,Je(t.value,(s,l)=>(q(),T("div",kt,[ae(Qe,{page:s,height:e.height,cell_size:e.cell_size,mirror:e.mirror,display_copy:e.display_copy},null,8,["page","height","cell_size","mirror","display_copy"]),$("div",null,"("+be(l+1)+") "+be(s.comment),1)]))),256))]))}});let re=null;async function Ft(){return re||(re=await Xe(()=>import("./pcf_wasm.m3Qeibh4.js"),[]),await re.default()),re.get_pc}const It={class:"fumen-list"},St={class:"fumen-item"},Nt={class:"fumen-ctl"},Bt={key:0},_e="v115@vhAAgH",Ct=de({__name:"PCF",props:{initial_field_fumen:{default:"v115@9gD8DeF8CeG8BeH8CeC8JeAgH"},sequence:{default:"ITSZ"},mirror:{type:Boolean,default:!1}},setup(r){const e=r,t=Me(()=>Q.decoder.decode(e.initial_field_fumen)[0]),n=C(BigInt(0)),o=C(_e),s=C(e.sequence);function l(i){n.value=i}async function a(){let i=(await Ft())(n.value,s.value.toUpperCase());i=="v115@"&&(i=_e),o.value=i}return(i,c)=>(q(),T(Be,null,[$("div",It,[$("div",St,[ae(Qe,{allow_edit:!0,page:t.value,onField_change:l,height:10,mirror:e.mirror},null,8,["page","mirror"])])]),$("div",Nt,[ae(Rt,{onClick:a},{default:He(()=>[...c[1]||(c[1]=[et("Solve",-1)])]),_:1}),Ye($("input",{"onUpdate:modelValue":c[0]||(c[0]=f=>s.value=f),onKeyup:Ke(a,["enter"])},null,544),[[Ve,s.value]])]),o.value!==_e?(q(),T("div",Bt,[ae(Lt,{fumen:o.value,height:10,display_copy:!1,mirror:e.mirror},null,8,["fumen","mirror"])])):we("",!0)],64))}}),Wt=tt(Ct,[["__scopeId","data-v-adb66e67"]]);export{Wt as P,Lt as _,xt as a,Qe as b,Rt as c,Tt as m,Q as t};
